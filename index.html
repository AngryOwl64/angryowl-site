<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<title>Snake</title>
<style>
  :root{
    --bg:#0b0e14; --panel:#111827; --muted:#9ca3af;
    --accent:#22c55e; --danger:#ef4444; --grid:#0f172a; --power:#60a5fa;
  }
  *{box-sizing:border-box}
  body{
    margin:0; height:100vh; display:flex; align-items:center; justify-content:center;
    background: radial-gradient(1200px 600px at 50% -10%, #1f2937 0%, transparent 60%),
                linear-gradient(180deg, #020617, var(--bg));
    color:#e5e7eb;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial;
  }
  .wrap{
    width:min(92vw,480px);
    display:grid; gap:12px; padding:18px;
    background:linear-gradient(180deg,#0b1220,#070b14);
    border-radius:18px;
    box-shadow:0 30px 80px rgba(0,0,0,.6), inset 0 1px 0 rgba(255,255,255,.05);
  }
  .hud{
    display:flex; justify-content:space-between; align-items:center;
    padding:10px 12px; border-radius:12px;
    background:rgba(17,24,39,.7); backdrop-filter: blur(6px);
    box-shadow: inset 0 1px 0 rgba(255,255,255,.05);
    font-weight:600;
  }
  .hud span{color:var(--muted); font-weight:500}
  .badge{
    font-size:12px; color:#cbd5e1;
    padding:4px 8px; border-radius:999px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(2,6,23,.45);
  }
  .stage{
    position:relative; border-radius:16px; overflow:hidden;
    box-shadow: inset 0 0 0 1px rgba(255,255,255,.05);
  }
  canvas{
    display:block; width:100%; height:auto;
    background:
      linear-gradient(0deg, transparent 19px, var(--grid) 20px),
      linear-gradient(90deg, transparent 19px, var(--grid) 20px),
      #020617;
    background-size:20px 20px;
  }
  .overlay{
    position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
    background:radial-gradient(500px 300px at 50% 40%, rgba(2,6,23,.55), rgba(2,6,23,.9));
    backdrop-filter: blur(2px);
  }
  .card{
    width:min(90%,360px);
    padding:18px; border-radius:16px;
    background:rgba(17,24,39,.86);
    box-shadow:0 20px 50px rgba(0,0,0,.6), inset 0 1px 0 rgba(255,255,255,.06);
    text-align:center;
  }
  .row{display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-top:10px}
  select,label{font:inherit}
  select,.toggle{
    background:#0b1220; color:#e5e7eb;
    border:1px solid rgba(255,255,255,.12);
    padding:8px 10px; border-radius:10px;
  }
  .toggle{display:flex; align-items:center; gap:8px}
  .btn{
    width:100%; margin-top:12px; padding:10px 14px; border-radius:12px;
    border:0; cursor:pointer; font-weight:800;
    background:linear-gradient(180deg,#34d399,#22c55e);
    color:#022c22; box-shadow:0 10px 30px rgba(34,197,94,.35);
  }
  .hint{margin-top:8px; font-size:12px; color:var(--muted)}
</style>
</head>
<body>

<div class="wrap">
  <div class="hud">
    <div>Score: <span id="score">0</span></div>
    <div style="display:flex;gap:10px;align-items:center;">
      <span class="badge" id="state">MENÜ</span>
      <div>High: <span id="high">0</span></div>
    </div>
  </div>

  <div class="stage">
    <canvas id="game" width="400" height="400"></canvas>

    <!-- Start / Game Over -->
    <div class="overlay" id="overlay">
      <div class="card">
        <h2 id="title">Snake</h2>
        <p id="text">Wähle Optionen und starte.</p>

        <div class="row">
          <div>
            <div style="text-align:left;font-size:12px;color:var(--muted);margin:0 0 6px 2px;">Schwierigkeit</div>
            <select id="difficulty">
              <option value="easy">Easy</option>
              <option value="normal" selected>Normal</option>
              <option value="hard">Hard</option>
            </select>
          </div>

          <label class="toggle">
            <input id="obstaclesOn" type="checkbox" checked>
            Obstacles
          </label>

          <label class="toggle">
            <input id="powersOn" type="checkbox" checked>
            Power-Ups
          </label>
        </div>

        <button class="btn" id="startBtn">Start</button>
        <div class="hint">Pfeile = Bewegung · Leertaste = Pause</div>
      </div>
    </div>
  </div>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const grid = 20;
const tiles = canvas.width / grid;

const scoreEl = document.getElementById("score");
const highEl = document.getElementById("high");
const overlay = document.getElementById("overlay");
const titleEl = document.getElementById("title");
const textEl = document.getElementById("text");
const stateEl = document.getElementById("state");

const diffEl = document.getElementById("difficulty");
const obstaclesOnEl = document.getElementById("obstaclesOn");
const powersOnEl = document.getElementById("powersOn");
document.getElementById("startBtn").onclick = start;

let snake, dx, dy, food, obstacles=[], power=null;
let score=0, speed=120, paused=false, over=false, timer=null;
let slowUntil = 0;

let high = +localStorage.getItem("snake_high") || 0;
highEl.textContent = high;

function speedFromDiff(v){ return v==="easy"?160 : v==="hard"?95 : 120; }

function showMenu(kind="menu", msg="Wähle Optionen und starte."){
  overlay.style.display="flex";
  stateEl.textContent = kind==="over" ? "GAME OVER" : "MENÜ";
  titleEl.textContent = kind==="over" ? "Game Over" : "Snake";
  textEl.textContent = msg;
}
function hideMenu(){
  overlay.style.display="none";
  stateEl.textContent = paused ? "PAUSE" : "PLAY";
}

function randPos(avoid=[]){
  let p;
  do{
    p={x:Math.floor(Math.random()*tiles),y:Math.floor(Math.random()*tiles)};
  }while(avoid.some(a=>a.x===p.x&&a.y===p.y));
  return p;
}

function spawnObstacles(){
  obstacles=[];
  if(!obstaclesOnEl.checked) return;
  const count = diffEl.value==="easy"?6: diffEl.value==="hard"?12:9;
  for(let i=0;i<count;i++){
    obstacles.push(randPos([...snake,food,...obstacles]));
  }
}

function spawnPower(){
  if(!powersOnEl.checked) return null;
  if(Math.random()<0.02){ // selten
    const types=["slow","bonus"];
    return { ...randPos([...snake,food,...obstacles]), type: types[Math.floor(Math.random()*types.length)] };
  }
  return null;
}

function start(){
  snake=[{x:10,y:10}];
  dx=1; dy=0;
  score=0; paused=false; over=false; power=null;
  speed = speedFromDiff(diffEl.value);
  food = randPos(snake);
  spawnObstacles();
  scoreEl.textContent=score;
  hideMenu();
  clearInterval(timer);
  timer=setInterval(loop,speed);
}

function loop(){
  if(paused||over) return;
  update(); draw();
}

function update(){
  let nx=snake[0].x+dx, ny=snake[0].y+dy;
  if(nx<0||ny<0||nx>=tiles||ny>=tiles){ end(); return; }
  const head={x:nx,y:ny};
  if(snake.some(s=>s.x===head.x&&s.y===head.y)) { end(); return; }
  if(obstacles.some(o=>o.x===head.x&&o.y===head.y)) { end(); return; }

  snake.unshift(head);

  // Food
  if(head.x===food.x&&head.y===food.y){
    score++; scoreEl.textContent=score;
    food = randPos([...snake,...obstacles]);
    if(score%5===0 && speed>70){
      speed-=8; clearInterval(timer); timer=setInterval(loop,speed);
    }
    if(!power) power = spawnPower();
  } else snake.pop();

  // Power-Up
  if(power && head.x===power.x && head.y===power.y){
    if(power.type==="slow"){
      slowUntil = Date.now()+3000;
      clearInterval(timer);
      timer=setInterval(loop, speed+60);
    }
    if(power.type==="bonus"){
      score+=3; scoreEl.textContent=score;
    }
    power=null;
  }

  // Slow endet
  if(slowUntil && Date.now()>slowUntil){
    slowUntil=0;
    clearInterval(timer);
    timer=setInterval(loop, speed);
  }
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Obstacles
  ctx.fillStyle="#475569";
  obstacles.forEach(o=>{
    ctx.fillRect(o.x*grid+2,o.y*grid+2,grid-4,grid-4);
  });

  // Snake
  ctx.shadowBlur=12; ctx.shadowColor="#22c55e";
  ctx.fillStyle="#22c55e";
  snake.forEach((p,i)=>{
    const pad=i===0?0:1;
    ctx.fillRect(p.x*grid+pad,p.y*grid+pad,grid-2*pad,grid-2*pad);
  });

  // Food
  ctx.shadowBlur=16; ctx.shadowColor="#ef4444";
  ctx.fillStyle="#ef4444";
  ctx.fillRect(food.x*grid+2,food.y*grid+2,grid-4,grid-4);

  // Power-Up
  if(power){
    ctx.shadowBlur=16;
    ctx.shadowColor = power.type==="slow" ? "#60a5fa" : "#a855f7";
    ctx.fillStyle = power.type==="slow" ? "#60a5fa" : "#a855f7";
    ctx.beginPath();
    ctx.arc(power.x*grid+10,power.y*grid+10,7,0,Math.PI*2);
    ctx.fill();
  }
  ctx.shadowBlur=0;
}

function end(){
  over=true;
  let msg=`Score: ${score}`;
  if(score>high){ high=score; localStorage.setItem("snake_high",high); highEl.textContent=high; msg+=" · Neuer Highscore"; }
  showMenu("over",msg);
}

document.addEventListener("keydown",e=>{
  if(e.key===" "){
    if(overlay.style.display==="flex") return;
    paused=!paused; stateEl.textContent=paused?"PAUSE":"PLAY"; return;
  }
  if(paused||overlay.style.display==="flex") return;
  if(e.key==="ArrowUp"&&dy===0){dx=0;dy=-1}
  if(e.key==="ArrowDown"&&dy===0){dx=0;dy=1}
  if(e.key==="ArrowLeft"&&dx===0){dx=-1;dy=0}
  if(e.key==="ArrowRight"&&dx===0){dx=1;dy=0}
});

// Start im Menü
showMenu();
</script>
</body>
</html>
